---
// src/components/projectList.astro
import { getCollection } from "astro:content";
import "../styles/project_grid.css";

const docs = await getCollection("docs");

const projects = docs.filter((d) =>
  d.id.endsWith("overview")
) as any[];

---

<div>

  <div id="project-list" class="grid">
  {projects.map((p) => (
    <a href={`/${p.id}`} class="card">
      <h3>{p.data.title}</h3>
      <p>{p.data.description}</p>
      <div class="tags">
        {(p.data.tags ?? []).map((t: string) => <span>{t}</span>)}
      </div>
    </a>
  ))}
</div>

  <script type="module">
    

    const projects = Array.from(
      document.querySelectorAll("#project-list article")
    );

    const categories = [...new Set(projects.map(p => p.dataset.category))].filter(Boolean);
    const tags = [
      ...new Set(
        projects.flatMap(p => (p.dataset.tags || "").split(" ").filter(Boolean))
      ),
    ];

    const catContainer = document.querySelector("#category-filters");
    if (catContainer) {
      categories.forEach((cat) => {
        const btn = document.createElement("button");
        btn.textContent = cat ?? "";
        
        catContainer.appendChild(btn);
      });
    }

    const tagContainer = document.querySelector("#tag-filters");
    if (tagContainer) {
      tags.forEach((tag) => {
        const btn = document.createElement("button");
        btn.textContent = tag;
        
        tagContainer.appendChild(btn);
      });
    }
  </script>
</div>
