---
// src/components/ProjectList.astro
import { getCollection } from "astro:content";
import "../styles/project-grid.css";

const docs = await getCollection("docs");

const projects = docs.filter((d) =>
  d.id.endsWith("overview")
) as any[];

const base = import.meta.env.BASE_URL;

---

<div>
  <div id="project-list" class="grid">
    {projects.map((p) => (
      <a href={`${base}${p.id}/`} class="card">
        <h3>{p.data.title}</h3>
        <p>{p.data.description}</p>
        <div class="tags">
          {(p.data.tags ?? []).map((t: string) => <span>{t}</span>)}
        </div>
      </a>
    ))}
  </div>

  <script type="module">
    // Build simple tag/category UI containers if present
    const projects = Array.from(
      document.querySelectorAll("#project-list .card")
    );

    // Read categories/tags via attributes without TS assertions
    const categories = [...new Set(projects.map(el => el.getAttribute('data-category') || ''))].filter(Boolean);
    const tags = [
      ...new Set(
        projects.flatMap(el => (el.getAttribute('data-tags') || '').split(' ').filter(Boolean))
      ),
    ];

    const catContainer = document.querySelector("#category-filters");
    if (catContainer) {
      categories.forEach((cat) => {
        const btn = document.createElement("button");
        btn.textContent = cat ?? "";
        catContainer.appendChild(btn);
      });
    }

    const tagContainer = document.querySelector("#tag-filters");
    if (tagContainer) {
      tags.forEach((tag) => {
        const btn = document.createElement("button");
        btn.textContent = tag;
        tagContainer.appendChild(btn);
      });
    }
  </script>
</div>
