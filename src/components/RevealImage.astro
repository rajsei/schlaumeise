---
interface Props {
  imageSrc: string;
  alt: string;
  overlayText?: string;
  revealLabel?: string;
}

const {
  imageSrc,
  alt,
  overlayText = "",
  revealLabel = "LÃ¶sung",
} = Astro.props as Props;
---

<section class="reveal is-hidden" data-reveal>
  <div class="reveal-layout">
    <button type="button" class="reveal-trigger" aria-pressed="false">
      <div class="reveal-frame">
        <img src={imageSrc} alt={alt} class="reveal-image" loading="lazy" />
        <div class="reveal-placeholder" aria-hidden="true">
          <span class="reveal-label">{revealLabel}</span>
        </div>
        {overlayText && <div class="reveal-overlay">{overlayText}</div>}
      </div>
    </button>

    <div class="reveal-content" data-reveal-content>
      <div class="reveal-skeleton" aria-hidden="true">
        <span class="skeleton-line"></span>
        <span class="skeleton-line short"></span>
      </div>
      <div class="reveal-slot">
        <slot />
      </div>
    </div>
  </div>
</section>

<script type="module">
  const roots = document.querySelectorAll("[data-reveal]");
  roots.forEach((root) => {
    if (!(root instanceof HTMLElement)) return;
    if (root.dataset.revealReady === "true") return;
    root.dataset.revealReady = "true";

    const trigger = root.querySelector(".reveal-trigger");
    if (!(trigger instanceof HTMLButtonElement)) return;

    trigger.addEventListener("click", () => {
      const isHidden = root.classList.contains("is-hidden");
      root.classList.toggle("is-hidden", !isHidden);
      trigger.setAttribute("aria-pressed", String(isHidden));
    });
  });
</script>

<style>
  .reveal {
    display: block;
  }

  .reveal-layout {
    display: block;
    padding: 0.5rem;
    border-radius: 12px;
    box-shadow: var(--global-shadow-inset);
    background-color: var(--sl-color-gray-6);
  }

  .reveal-trigger {
    border: 0;
    padding: 0;
    background: transparent;
    cursor: pointer;
    margin: 0;
    float: left;
    max-width: 20rem;
    width: min(20rem, 100%);
    margin-right: 1.5rem;
    margin-bottom: 1rem;
  }

  .reveal-frame {
    position: relative;
    width: 100%;
    aspect-ratio: 16 / 9;
    border-radius: 0.75rem;
    overflow: hidden;
  }

  .reveal-image {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transform: translateY(0);
    transition: transform 240ms ease;
  }

  .reveal-overlay {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgb(0 0 0 / 0.65);
    color: #fff;
    font-size: 0.9rem;
    padding: 0.5rem 0.75rem;
  }

  .reveal-placeholder {
    position: absolute;
    margin: 0;
    inset: 0;
    display: grid;
    place-items: center;
    background: var(--sl-color-gray-5);
  }

  .reveal-label {
    color: var(--sl-color-gray-2);
    font-size:xx-large;
    font-weight: 700;
    letter-spacing: 0.02em;
  }

  .reveal-content {
    position: relative;
  }

  .reveal-slot {
    margin-top: 0;
  }

  .reveal-skeleton {
    display: none;
    gap: 0.5rem;
    flex-direction: column;
  }

  .skeleton-line {
    display: block;
    height: 0.85rem;
    background: var(--sl-color-gray-5);
    border-radius: 999px;
    width: min(28rem, 100%);
  }

  .skeleton-line.short {
    width: min(18rem, 70%);
  }

  .reveal.is-hidden .reveal-image {
    opacity: 0;
  }

  .reveal.is-hidden .reveal-placeholder {
    display: grid;
  }

  .reveal.is-hidden .reveal-overlay {
    display: none;
  }

  .reveal.is-hidden .reveal-skeleton {
    display: flex;
  }

  .reveal.is-hidden .reveal-slot {
    visibility: hidden;
    height: 0;
    overflow: hidden;
  }

  .reveal:not(.is-hidden) .reveal-placeholder {
    display: none;
  }

  .reveal-layout::after {
    content: "";
    display: block;
    clear: both;
  }

  @media (prefers-reduced-motion: reduce) {
    .reveal-image {
      transition: none;
    }
  }

  @media (max-width: 720px) {
    .reveal-layout {
      display: block;
    }

    .reveal-trigger {
      float: none;
      width: 100%;
      margin-right: 0;
    }
  }
</style>
